<xml>

<setup name="androidNdk" />
    
<!-- Set architecture -->
<section if="HXCPP_X86">
  <set name="ARCH" value="-x86" />
  <!--<set name="ABI" value="x86"  />-->
  <!--<set name="PLATFORM_ARCH" value="arch-x86" />-->
  <set name="EXEPREFIX" value="i686-linux-android" />
  <set name="TARGET_TARGET" value="${EXEPREFIX}${PLATFORM_NUMBER}" />
</section>

<section unless="HXCPP_X86">
  <set name="ARCH" value="-v7" if="HXCPP_ARMV7" />
  <set name="ABI" value="armeabi-v7a" />
  <set name="PLATFORM_ARCH" value="arch-arm" />
  <set name="PLATFORM" value="android-5" unless="PLATFORM" />
  <set name="TARGET_TARGET" value="armv7a-linux-androideabi${PLATFORM_NUMBER}" />
  <set name="EXEPREFIX" value="arm-linux-androideabi" />
</section>

<section if="HXCPP_ARM64">
  <set name="ARCH" value="-64"/>
  <set name="ABI" value="arm64-v8a" />
  <set name="PLATFORM_ARCH" value="arch-arm64" />
  <set name="TOOLCHAIN" value="aarch64-linux-android-${TOOLCHAIN_VERSION}" />
  <set name="EXEPREFIX" value="aarch64-linux-android" />
  <set name="PLATFORM" value="android-19" unless="PLATFORM" />
</section>

<set name="prebuiltBase" value="${ANDROID_NDK_ROOT}/toolchains/llvm/prebuilt/${ANDROID_HOST}/" />

<path name="${prebuiltBase}/bin" />

<set name="HXCPP_AR" value="arm-linux-androideabi-ar" />

<include name="toolchain/gcc-toolchain.xml"/>

<compiler id="android-gcc" exe="clang++">

  <exe name="clang++" />
  <flag value="--target=${TARGET_TARGET}" />
    
  <include name="toolchain/common-defines.xml" />
  <flag value="-flto" if="HXCPP_OPTIMIZE_LINK" unless="debug"/>
  <flag value="-I${HXCPP}/include"/>
  <flag value="-Iinclude"/>
  
  <flag value="-fpic"/>
  <flag value="-fvisibility=hidden"/>
  <flag value="-ffunction-sections"/>
  <flag value="-fstack-protector"/>
  <flag value="-fno-short-enums"/>
  <flag value="-Wno-overflow" />
  <cppflag value="-Wno-invalid-offsetof" />
  <cppflag value="-frtti"/>
  <flag value="-D_LINUX_STDDEF_H "/> <!-- Avoid compiler including 2 version of file -->

<!--<section if="HXCPP_ARMV7">-->
   <!--<flag value="-mfpu=vfpv3-d16"  />-->
<!--</section>-->

  <flag value="-fomit-frame-pointer"/>
  <flag value="-fexceptions"/>
  <flag value="-fno-strict-aliasing"/>
  <flag value="-DANDROID=ANDROID"/>
  <flag value="-DHX_ANDROID"/>
  <flag value="${ANDROID_PLATFORM_DEFINE}"/>
  
  <flag value="-Wa,--noexecstack"/>
  <flag value="-O2" unless="debug || HXCPP_OPTIMIZE_FOR_SIZE || HXCPP_OPTIMIZE_FOR_FAST"/>
  
  <section if="HXCPP_OPTIMIZE_FOR_FAST" unless="debug">
    <flag value="-Ofast" />
  </section>
  <flag value="-O0" if="debug"/>
  <flag value="-g" if="HXCPP_DEBUG_LINK"/>
  <!--<flag value="-DNDEBUG"/>-->
  <flag value="-DHXCPP_LOAD_DEBUG" if="HXCPP_LOAD_DEBUG"/>
  <flag value="-c"/>
  <outflag value="-o"/>
  <ext value=".obj"/>
    
  <objdir value="obj/android${OBJEXT}${ARCH}" />
</compiler>


<linker id="dll" exe="clang++" >

  <exe name="clang++" />
  <flag value ="-shared" />
  <flag value="--target=${TARGET_TARGET}" />

  <flag value ="-static-libstdc++" />
  <flag value ="-v" />
  <prefix value="lib"/>
  <lib name="-llog"/>
    
</linker>
    
</xml>
